pipeline {
        agent {
            docker {
                image 'python:3.9-slim'
            }
        }
        stages {
            stage('Checkout') {
                steps {
                    git 'https://github.com/jareinafp/simple-python-pyinstaller-app'
                }
            }
            stage('Instalar PyInstaller') {
                steps {
                    sh 'pip install pyinstaller'
                }
            }
            stage('Construir la aplicaci√≥n') {
                steps {
                    sh 'pyinstaller --onefile sources/add2vals.py'
                }
            }
            stage('Construir imagen Docker') {
                steps {
                    script {
                        def appName = "add2vals"
                        def imageName = "mi-registro/simple-python-app:${BUILD_NUMBER}"
                        sh "docker build -t ${imageName} ."
                        sh "docker push ${imageName}"
                    }
                }
            }
            stage('Desplegar') {
                steps {
                    script {
                        def imageName = "mi-registro/simple-python-app:${BUILD_NUMBER}"
                        sh "docker run -d -p 8080:8080 ${imageName}"
                    }
                }
            }
        }
    }
